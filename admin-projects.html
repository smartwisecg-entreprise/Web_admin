<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Portfolio Smart Wise</title>
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <!-- Police : Poppins (Comme News) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* --- DESIGN SYSTEM (COPI√â DE LA PAGE NEWS) --- */
        :root {
            --primary: #4e7994;
            --primary-dark: #3a5e75;
            --secondary: #f0f4f8;
            --accent: #eef2f6;
            --text-main: #2c3e50;
            --text-light: #64748b;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-body: #f1f5f9;
            --card-bg: #ffffff;
            --radius: 12px;
            --border: #cbd5e1;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            outline: none;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .main-wrapper {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* --- CARDS & CONTAINERS --- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
        }

        h1,
        h2 {
            color: var(--primary);
            margin-top: 0;
            font-weight: 700;
        }

        h1 {
            border-bottom: 2px solid var(--accent);
            padding-bottom: 20px;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        /* --- EN-T√äTE AVEC LOGO (Style unifi√©) --- */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            /* Centre le titre */
            position: relative;
            /* Permet de fixer le logo en absolu */
            border-bottom: 2px solid var(--accent);
            padding-bottom: 20px;
            margin-bottom: 30px;
            min-height: 60px;
            /* Hauteur suffisante pour le logo agrandi */
        }

        .header-logo {
            position: absolute;
            left: 0;
            max-height: 150px;
            /* Logo agrandi comme demand√© */
            width: auto;
        }

        /* On nettoie le style par d√©faut du H1 car c'est le conteneur qui g√®re maintenant les marges/bordures */
        .header-container h1 {
            margin: 0;
            border: none;
            padding: 0;
            text-align: center;
        }

        /* Adaptation Mobile */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header-logo {
                position: static;
                /* Le logo s'empile au-dessus */
                margin-bottom: 10px;
            }
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-light);
            font-weight: 700;
            margin-bottom: 15px;
            display: block;
            border-bottom: 1px solid var(--accent);
            padding-bottom: 5px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 35px;
            /* Augment√© de 20px √† 35px pour plus d'espace */
            position: relative;
        }

        /* --- LAYOUT GRID (ALIGNE PARFAITEMENT) --- */
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* 2 colonnes strictement √©gales */
            gap: 25px;
            /* Espace entre les colonnes */
            margin-bottom: 20px;
            align-items: start;
            /* Aligne les √©l√©ments en haut */
        }

        /* En mobile, on passe en 1 colonne */
        @media (max-width: 768px) {
            .row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        /* --- INPUTS & TEXTAREA --- */
        /* 1. Hauteur fixe pour les inputs simples */
        input[type="text"],
        select {
            width: 100%;
            height: 50px;
            /* HAUTEUR STRICTE */
            padding: 0 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #f8fafc;
            font-family: inherit;
            font-size: 0.95rem;
            color: var(--text-main);
            transition: all 0.3s ease;
            box-sizing: border-box;
            /* IMPORTANT pour le calcul des largeurs */
        }

        /* 2. Hauteur fixe pour les zones de texte */
        textarea {
            width: 100%;
            height: 140px;
            /* HAUTEUR STRICTE & IDENTIQUE */
            min-height: 140px;
            /* Emp√™che de r√©duire trop */
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #f8fafc;
            font-family: inherit;
            font-size: 0.95rem;
            color: var(--text-main);
            transition: all 0.3s ease;
            box-sizing: border-box;
            resize: vertical;
            /* Autorise le redimensionnement vertical uniquement */
        }

        /* Focus states */
        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(78, 121, 148, 0.15);
        }

        /* Labels align√©s */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-main);
            line-height: 1.5;
            /* Assure que les labels FR et EN ont la m√™me hauteur de ligne */
        }

        /* --- IMAGE UPLOAD ZONE (MODERNE) --- */
        .image-upload-wrapper {
            position: relative;
            width: 100%;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            background: #f8fafc;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: #eef2f6;
        }

        .upload-area.has-image {
            border-style: solid;
            border-color: var(--primary);
            padding: 10px;
        }

        #imageFile {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        #currentImagePreview {
            display: none;
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            object-fit: cover;
        }

        /* --- TAGS SYSTEM (ADAPT√â AU TH√àME) --- */
        .tech-container {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            background: #f8fafc;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 50px;
            transition: all 0.2s;
        }

        .tech-container:focus-within {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(78, 121, 148, 0.15);
        }

        .tech-tag {
            background: var(--accent);
            color: var(--primary-dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #dae1e7;
        }

        .tech-tag span {
            cursor: pointer;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 50%;
        }

        .tech-tag span:hover {
            color: var(--danger);
            background: #fff;
        }

        .tech-input {
            border: none !important;
            background: transparent !important;
            padding: 5px !important;
            flex: 1;
            min-width: 120px;
            box-shadow: none !important;
        }

        .suggestions-box {
            position: absolute;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: var(--shadow);
            width: 100%;
            display: none;
            margin-top: 5px;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .suggestion-item:hover {
            background: var(--accent);
            color: var(--primary);
        }

        /* --- BUTTONS --- */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        #btnSave {
            background: var(--primary);
        }

        #btnSave:hover {
            background: var(--primary-dark);
        }

        #btnCancel {
            background: #94a3b8;
            display: none;
        }

        #btnCancel:hover {
            background: #64748b;
        }

        button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        /* --- LISTE PROJETS --- */
        .project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .card-preview {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }

        .card-preview:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .card-preview img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-bottom: 1px solid #eef2f6;
        }

        .card-info {
            padding: 20px;
        }

        .card-cat {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--primary);
            background: var(--accent);
            padding: 4px 10px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .card-title {
            font-weight: 700;
            font-size: 1.05rem;
            margin-bottom: 15px;
            color: var(--text-main);
            line-height: 1.4;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .edit-btn {
            background: #eff6ff;
            color: var(--primary);
        }

        .edit-btn:hover {
            background: #dbeafe;
        }

        .delete-btn {
            background: #fef2f2;
            color: var(--danger);
        }

        .delete-btn:hover {
            background: #fee2e2;
        }

        .hidden {
            display: none;
        }

        #statusMessage {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        /* Emp√™che de voir le contenu avant la v√©rification */
        #adminContent {
            display: none;
        }

        /* --- BARRE DE NAVIGATION √âPUR√âE (STYLE ACTU) --- */
        .logout-bar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--accent);
            padding: 12px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        /* Bouton de navigation entre les pages */
        .nav-link-btn {
            color: var(--primary);
            text-decoration: none;
            background: var(--secondary);
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .nav-link-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Infos utilisateur & Profil */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-profile-box {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #fff;
            padding: 5px 18px;
            border-radius: 50px;
            border: 1px solid var(--accent);
            height: 45px;
            box-sizing: border-box;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .user-profile-box:hover {
            transform: scale(1.02);
            border-color: var(--primary);
        }

        #userAvatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        #userName {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-main);
            line-height: 1.2;
        }

        .role-badge {
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--text-light);
            letter-spacing: 0.5px;
        }

        /* Bouton d√©connexion pilule */
        .logout-btn {
            background: #fff;
            color: var(--text-light);
            border: 1px solid var(--accent);
            padding: 0 18px;
            border-radius: 50px;
            height: 45px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .logout-btn:hover {
            background: #fef2f2;
            color: var(--danger);
            border-color: var(--danger);
            transform: translateY(-1px);
        }

        /* On force le body √† ne pas avoir de padding en haut pour coller la barre */
        body {
            margin: 0 !important;
            padding: 0 !important;
        }

        .main-wrapper {
            margin-top: 30px;
            padding: 0 20px;
            /* On remet le padding ici pour le contenu */
        }

        /* --- STYLE DE LA MODALE AVATAR --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-card {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            overflow: hidden;
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
            text-align: center;
            background: #f8fafc;
        }

        /* Pour que la zone de s√©lection du cropper soit ronde */
        .cropper-view-box,
        .cropper-face {
            border-radius: 50%;
            outline: none;
        }

        /* --- MODIFICATIONS CSS --- */
        .modal-body {
            padding: 0;
            /* On laisse Cropper prendre l'espace */
            background: #ebebeb;
            min-height: 300px;
            max-height: 70vh;
            overflow: hidden;
            position: relative;
        }

        /* Important pour Cropper.js : l'image doit √™tre en block et max-width 100% */
        #modalAvatarPreview {
            display: block;
            max-width: 100%;
        }

        /* Conteneur pour limiter la hauteur de la zone de travail */
        .img-container {
            width: 100%;
            height: 400px;
            /* Hauteur fixe ou min-height pour la zone de travail */
            background-color: #f7f7f7;
        }

        .modal-footer {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 20px;
        }

        .modal-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: 0.2s;
        }

        .upload-btn {
            background: var(--primary);
            color: white;
        }

        .upload-btn:hover {
            background: var(--primary-dark);
        }

        .delete-btn-modal {
            background: #fee2e2;
            color: #ef4444;
        }

        .delete-btn-modal:hover {
            background: #fecaca;
        }

        /* On rend le profil cliquable dans la barre de nav */
        .user-profile-box {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .user-profile-box:hover {
            transform: scale(1.02);
            border-color: var(--primary);
        }

        .accounts-btn {
            /* M√™mes dimensions et style de base que logout-btn */
            background: #fff;
            color: var(--text-light);
            border: 1px solid var(--accent);
            padding: 0 18px;
            border-radius: 50px;
            /* Forme Pilule */
            height: 45px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        /* Au survol : Devient Bleu (Ta couleur Primary) */
        .accounts-btn:hover {
            background: #eef2f6;
            color: var(--primary);
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        /* ==========================================================================
   GESTION RESPONSIVE COMPL√àTE (MOBILE & TABLETTE)
   ========================================================================== */

        /* --- TABLETTE ET MOBILE (Max 992px) --- */
        @media (max-width: 992px) {
            .main-wrapper {
                padding: 0 15px;
                /* Marges lat√©rales de s√©curit√© */
            }
        }

        /* --- MOBILE LARGE (Max 768px) --- */
        @media (max-width: 768px) {

            /* 1. Ajustement global */
            body {
                padding-bottom: 60px;
                /* Espace pour scroller tout en bas */
            }

            .card {
                padding: 25px 20px;
                /* Moins de padding dans la carte principale */
            }

            /* 2. Barre de Navigation (Logout Bar) - C'√©tait le point bloquant */
            .logout-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
                height: auto;
                position: relative;
                /* On enl√®ve le sticky sur mobile si g√™nant */
            }

            .user-info {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            /* On cache les textes du profil pour gagner de la place, on garde l'avatar */
            .user-details {
                display: none;
            }

            /* Boutons pleine largeur pour le tactile */
            .nav-link-btn,
            .accounts-btn,
            .logout-btn {
                width: 100%;
                justify-content: center;
            }

            .btn-group {
                flex-direction: column;
                /* Boutons Sauvegarder/Annuler l'un sous l'autre */
            }

            /* 3. En-t√™te avec Logo (Renforcement) */
            .header-container {
                flex-direction: column;
                height: auto;
                text-align: center;
                margin-bottom: 20px;
                border-bottom: none;
                padding-bottom: 10px;
            }

            .header-logo {
                position: static;
                /* Vital pour ne pas √©craser le texte */
                margin-bottom: 15px;
                max-height: 80px;
                /* Logo plus petit */
            }

            .header-container h1 {
                font-size: 1.5rem;
                border-bottom: 2px solid var(--accent);
                width: 100%;
                padding-bottom: 15px;
            }

            /* 4. Formulaires (.row remplace .form-grid) */
            .row {
                grid-template-columns: 1fr;
                /* Force une seule colonne */
                gap: 15px;
            }

            .form-group {
                margin-bottom: 20px;
                /* R√©duit l'espace vertical */
            }

            /* 5. Liste des Projets */
            .project-list {
                /* On force une colonne sur mobile pour avoir de belles grandes cartes */
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .card-preview img {
                height: 180px;
                /* Image un peu plus haute pour bien voir */
            }
        }

        /* --- PETIT MOBILE (Max 480px) --- */
        @media (max-width: 480px) {

            /* Design "Bord √† bord" pour gagner de la place */
            .main-wrapper {
                padding: 0 10px;
                margin-top: 15px;
            }

            .card {
                padding: 20px 15px;
                border-radius: 8px;
            }

            /* Adaptation de la Modale Avatar */
            .modal-card {
                width: 95%;
                border-radius: 12px;
            }

            .modal-footer {
                grid-template-columns: 1fr;
                /* Boutons empil√©s */
            }

            .img-container {
                height: 300px;
                /* Zone de crop moins haute */
            }

            /* √âvite le zoom automatique sur iPhone lors de la saisie */
            input,
            select,
            textarea {
                font-size: 16px !important;
            }
        }
    </style>

</head>

<body>

    <!-- BARRE DE NAVIGATION UNIFI√âE -->
    <div class="logout-bar">
        <div class="nav-links">
            <!-- Bouton vers l'autre page admin -->
            <a href="admin-news.html" class="nav-link-btn">üì∞ G√©rer les Actualit√©s</a>
        </div>

        <div class="user-info">
            <div class="user-profile-box">
                <img id="userAvatar" src="" alt="" style="display:none;">
                <div class="user-details">
                    <span id="userName">Chargement...</span>
                    <span id="userRole" class="role-badge">√âditeur</span>
                </div>
            </div>
            <!-- 2. NOUVEAU BOUTON COMPTES (Plac√© au milieu) -->
            <!-- Notez la classe "accounts-btn" que nous allons cr√©er -->
            <!-- BOUTON COMPTES (Ajout de l'ID et display:none) -->
            <button id="btnManageAccounts" onclick="openAccountModal()" class="accounts-btn" style="display:none;">
                üë• Comptes
            </button>
            <button onclick="logout()" class="logout-btn">D√©connexion üö™</button>
        </div>
    </div>
    <div id="adminContent">

        <div class="main-wrapper">
            <!-- FORMULAIRE -->
            <div class="card">
                <!-- EN-T√äTE DU FORMULAIRE AVEC LOGO -->
                <div class="header-container">
                    <!-- Mettez ici le lien de votre logo -->
                    <img src="/images/SMARTWISE_LOGO_FINAL_24_Septembre_2025.svg" alt="Logo Smart Wise"
                        class="header-logo">

                    <h1 id="formTitle">Nouveau Projet</h1>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Type d'affichage</label>
                        <select id="projType" onchange="toggleFields()">
                            <option value="modal">‚ú® Ouverture en Pop-up (Modale)</option>
                            <option value="link">üîó Redirection vers une page (Lien)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Domaine d'expertise</label>
                        <select id="category">
                            <option value="web">üåê D√©veloppement Web</option>
                            <option value="logiciel">üíª Logiciels & Desktop</option>
                            <option value="mobile">üì± Applications Mobiles</option>
                            <option value="infra">‚òÅÔ∏è Infrastructure & Cloud</option>
                            <option value="devops">üöÄ DevOps & CI/CD</option>
                            <option value="data">üìä Data & IA</option>
                            <option value="uiux">üé® Design UI/UX</option>
                            <option value="cyber">üîí Cybers√©curit√©</option>
                        </select>
                    </div>
                </div>

                <span class="section-title">Visuel & Accroche</span>

                <!-- ZONE IMAGE MODERNE -->
                <div class="form-group">
                    <label>Image de couverture</label>
                    <div class="image-upload-wrapper">
                        <div class="upload-area" id="uploadArea">
                            <div id="uploadPlaceholder">
                                <div class="upload-icon">üì∑</div>
                                <div class="upload-text">
                                    Cliquez pour ajouter une image<br>
                                    <small style="opacity:0.6">JPG, PNG, WEBP</small>
                                </div>
                            </div>
                            <img id="currentImagePreview" alt="Aper√ßu">
                        </div>
                        <input type="file" id="imageFile" accept="image/*">
                    </div>
                </div>

                <!-- TITRES FR / EN -->
                <div class="row">
                    <div class="col">
                        <label>Titre (FR) *</label>
                        <input type="text" id="titleDefault" placeholder="Ex: Refonte Site BTP">
                    </div>
                    <div class="col">
                        <label class="label-en">Title (EN)</label>
                        <input type="text" id="titleEn" placeholder="Optional English Title">
                    </div>
                </div>

                <!-- DESCRIPTIONS COURTES FR / EN -->
                <div class="row">
                    <div class="col">
                        <label>Accroche Courte (FR)</label>
                        <input type="text" id="descDefault" placeholder="1 phrase d'accroche...">
                    </div>
                    <div class="col">
                        <label class="label-en">Short Description (EN)</label>
                        <input type="text" id="descEn" placeholder="Optional short desc...">
                    </div>
                </div>

                <!-- CHAMPS MODALE -->
                <div id="modalFields">
                    <span class="section-title">D√©tails Techniques (Pop-up)</span>

                    <div class="form-group">
                        <label>Client / Contexte</label>
                        <input type="text" id="clientName" placeholder="Ex: Startup Fintech Paris">
                    </div>

                    <!-- TAGS INPUT -->
                    <div class="form-group" style="position: relative;">
                        <label>Stack Technique (Tags)</label>
                        <div class="tech-container" id="techWrapper">
                            <input type="text" id="techInput" class="tech-input" placeholder="Ajouter (ex: React)..."
                                autocomplete="off">
                        </div>
                        <div id="suggestionsBox" class="suggestions-box"></div>
                    </div>
                    <!-- DESCRIPTIONS COMPL√àTES -->
                    <div class="row">
                        <div class="col">
                            <label>Description Compl√®te (FR)</label>
                            <textarea id="fullDesc" placeholder="D√©tails du projet..."></textarea>
                        </div>
                        <div class="col">
                            <label class="label-en">Full Description (EN)</label>
                            <textarea id="fullDescEn" placeholder="Project details..."></textarea>
                        </div>
                    </div>

                    <!-- CHAMPS LIEN -->
                    <div id="linkFields" class="hidden">
                        <span class="section-title">Destination (Lien Direct)</span>
                        <div class="form-group">
                            <label>URL de destination</label>
                            <input type="text" id="linkUrl" placeholder="https://mon-site.com/projet">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="btnCancel" class="btn">Annuler</button>
                        <button id="btnSave" class="btn">üöÄ Publier le Projet</button>
                    </div>

                    <div id="statusMessage"></div>
                </div>

                <!-- LISTE -->
                <div class="card">
                    <h2>Projets en Ligne</h2>
                    <div id="projectsList" class="project-list">
                        <p style="text-align:center; color: var(--text-light);">Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- Modal Avatar style "WhatsApp" -->
            <div id="avatarModal" class="modal-overlay" style="display:none;">
                <div class="modal-card">
                    <div class="modal-header">
                        <h3>Photo de profil</h3>
                        <span class="close-modal" onclick="closeAvatarModal()">&times;</span>
                    </div>

                    <div class="modal-body">
                        <div class="img-container">
                            <img id="modalAvatarPreview" src="" alt="Aper√ßu">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="modal-btn upload-btn" onclick="triggerFileInput()">
                            <span>üì∑</span> Modifier
                        </button>
                        <button class="modal-btn delete-btn-modal" onclick="deleteAvatar()">
                            <span>üóëÔ∏è</span> Supprimer
                        </button>
                    </div>
                </div>
                <!-- Input invisible pour choisir le fichier -->
                <input type="file" id="avatarInputHidden" accept="image/*" style="display:none;"
                    onchange="uploadAvatar(this)">
            </div>

            <!-- MODALE GESTION COMPTES -->
            <div id="accountModal" class="modal-overlay" style="display:none;">
                <div class="modal-card" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>Gestion des Acc√®s</h3>
                        <span class="close-modal" onclick="closeAccountModal()">&times;</span>
                    </div>

                    <div class="modal-body" style="padding: 20px; background: #fff; min-height: auto;">

                        <!-- MENU PRINCIPAL (2 BOUTONS) -->
                        <div id="accMenu" style="display:flex; gap:15px; justify-content:center; padding: 20px 0;">
                            <button onclick="showAddUser()" class="btn" style="background:var(--primary);">
                                ‚ûï Ajouter un compte
                            </button>
                            <button onclick="showDeleteUser()" class="btn"
                                style="background: #fef2f2; color: var(--danger); border: 1px solid var(--danger);">
                                üóëÔ∏è Supprimer / Lister
                            </button>
                        </div>

                        <!-- FORMULAIRE AJOUT (Cach√© par d√©faut) -->
                        <div id="accAddForm" class="hidden">
                            <h4 style="margin-top:0;">Cr√©er un nouvel utilisateur</h4>
                            <div class="form-group">
                                <label>Nom d'utilisateur</label>
                                <input type="text" id="newUsername" placeholder="Ex: JeanDupont">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="text" id="newEmail" placeholder="email@smartwise.com">
                            </div>
                            <div class="form-group">
                                <label>Mot de passe provisoire</label>
                                <input type="text" id="newPass" placeholder="Min. 6 caract√®res">
                            </div>
                            <div class="form-group">
                                <label>R√¥le</label>
                                <select id="newRole">
                                    <option value="editeur">√âditeur</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            <div class="btn-group">
                                <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                                <button onclick="createUser()" class="btn"
                                    style="background:var(--primary);">Cr√©er</button>
                            </div>
                        </div>

                        <!-- LISTE SUPPRESSION (Cach√© par d√©faut) -->
                        <div id="accListPanel" class="hidden">
                            <h4 style="margin-top:0;">Utilisateurs actifs</h4>
                            <div id="usersListContainer"
                                style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px;">
                                <!-- La liste sera inject√©e ici par JS -->
                            </div>
                            <div class="btn-group">
                                <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                            </div>
                            <p style="font-size:0.75rem; color:orange; margin-top:10px;">
                                ‚ö†Ô∏è Note : La suppression ici retire le profil. Pour bloquer d√©finitivement l'acc√®s,
                                supprimez aussi l'utilisateur dans le tableau de bord Supabase.
                            </p>
                        </div>

                    </div>
                </div>
            </div>



        </div>


        <script>
            // ============================================================
            // CONFIGURATION SUPABASE
            // ============================================================
            const SUPABASE_URL = 'https://neensjugjhkvwcqslicr.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5lZW5zanVnamhrdndjcXNsaWNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5Mjg1NzQsImV4cCI6MjA4MTUwNDU3NH0.eDEhhT8HzetCntUZ2LYkZhtoUjSjmFxPQqm03aAL8tU';
            const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

            // ==========================================
            // GESTION DE LA MODALE AVATAR AVEC AJUSTEMENT
            // ==========================================

            let cropper; // Variable globale pour l'outil de recadrage
            const modalPreview = document.getElementById('modalAvatarPreview');
            const uploadBtn = document.querySelector('.upload-btn');

            // 1. Ouvrir la modale
            document.querySelector('.user-profile-box').onclick = function () {
                const currentSrc = document.getElementById('userAvatar').src;
                modalPreview.src = currentSrc;
                document.getElementById('avatarModal').style.display = 'flex';
            };

            // 2. Fermer la modale et nettoyer
            function closeAvatarModal() {
                if (cropper) {
                    cropper.destroy();
                    cropper = null;
                }
                document.getElementById('avatarModal').style.display = 'none';
                // Remettre le bouton dans son √©tat initial
                uploadBtn.innerHTML = "<span>üì∑</span> Modifier";
                uploadBtn.onclick = triggerFileInput;
            }

            // 3. D√©clencher le choix de fichier
            function triggerFileInput() {
                document.getElementById('avatarInputHidden').click();
            }

            // 4. Charger l'image dans l'outil d'ajustement (Lanc√© apr√®s choix du fichier)
            async function uploadAvatar(input) {
                if (!input.files || input.files.length === 0) return;

                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    // 1. On affecte la source
                    modalPreview.src = e.target.result;

                    // 2. On attend que l'image soit charg√©e dans le DOM pour lancer Cropper
                    modalPreview.onload = function () {
                        // D√©truire l'ancien cropper s'il existe
                        if (cropper) {
                            cropper.destroy();
                        }

                        // Initialiser Cropper.js
                        cropper = new Cropper(modalPreview, {
                            aspectRatio: 1,
                            viewMode: 1, // Restreint la bo√Æte de recadrage √† l'int√©rieur du canvas
                            dragMode: 'move',
                            autoCropArea: 0.8,
                            restore: false,
                            guides: true,
                            center: true,
                            highlight: false,
                            cropBoxMovable: true,
                            cropBoxResizable: true,
                            toggleDragModeOnDblclick: false,
                            ready() {
                                console.log("Cropper est pr√™t");
                                // Transformer le bouton
                                uploadBtn.innerHTML = "<span>‚úÖ</span> Valider ce cadrage";
                                uploadBtn.onclick = confirmCrop;
                            }
                        });
                    };
                };
                reader.readAsDataURL(file);
            }

            // 5. Envoyer l'image recadr√©e sur Supabase
            async function confirmCrop() {
                if (!cropper) return;

                // R√©cup√©rer le canvas de l'image recadr√©e (400x400px pour un bon ratio qualit√©/poids)
                cropper.getCroppedCanvas({ width: 400, height: 400 }).toBlob(async (blob) => {
                    try {
                        uploadBtn.innerText = "Chargement...";
                        uploadBtn.disabled = true;

                        const { data: { session } } = await supabaseClient.auth.getSession();
                        const userId = session.user.id;

                        // Nom de fichier unique pour √©viter le cache navigateur
                        const fileName = `${userId}/${Date.now()}.png`;

                        // A. Upload vers le bucket 'avatars'
                        const { error: uploadError } = await supabaseClient.storage
                            .from('avatars')
                            .upload(fileName, blob, { contentType: 'image/png', upsert: true });

                        if (uploadError) throw uploadError;

                        // B. R√©cup√©rer l'URL publique
                        const { data: urlData } = supabaseClient.storage.from('avatars').getPublicUrl(fileName);
                        const publicUrl = urlData.publicUrl;

                        // C. Mettre √† jour la table 'profiles'
                        const { error: dbError } = await supabaseClient
                            .from('profiles')
                            .update({ avatar_url: publicUrl })
                            .eq('id', userId);

                        if (dbError) throw dbError;

                        // D. Mise √† jour de l'interface en temps r√©el
                        document.getElementById('userAvatar').src = publicUrl;
                        alert("Photo de profil mise √† jour !");
                        closeAvatarModal();

                    } catch (error) {
                        alert("Erreur lors de l'enregistrement : " + error.message);
                    } finally {
                        uploadBtn.disabled = false;
                    }
                }, 'image/png');
            }

            // 6. Supprimer l'avatar (Retour aux initiales)
            async function deleteAvatar() {
                if (!confirm("Supprimer votre photo de profil ?")) return;

                const { data: { session } } = await supabaseClient.auth.getSession();
                const userId = session.user.id;

                try {
                    const { error } = await supabaseClient
                        .from('profiles')
                        .update({ avatar_url: null })
                        .eq('id', userId);

                    if (error) throw error;

                    // Remettre l'avatar par d√©faut via l'API ui-avatars
                    const name = document.getElementById('userName').innerText;
                    const defaultAvatar = `https://ui-avatars.com/api/?name=${name}&background=4e7994&color=fff`;

                    document.getElementById('userAvatar').src = defaultAvatar;
                    alert("Photo supprim√©e.");
                    closeAvatarModal();

                } catch (error) {
                    alert("Erreur : " + error.message);
                }
            }

            // Fermer la modale si on clique √† c√¥t√©
            window.onclick = function (event) {
                const modal = document.getElementById('avatarModal');
                if (event.target == modal) closeAvatarModal();
            }


            // ==========================================
            // 3. AUTHENTIFICATION ET PROFIL
            // ==========================================
            async function checkUser() {
                // 1. V√©rification de la session
                const { data: { session } } = await supabaseClient.auth.getSession();

                if (!session) {
                    window.location.href = 'index.html';
                    return;
                }

                try {
                    // 2. R√©cup√©ration du profil complet depuis Supabase
                    const { data: profile, error } = await supabaseClient
                        .from('profiles')
                        .select('display_name, avatar_url, role')
                        .eq('id', session.user.id)
                        .single();

                    if (error) throw error;

                    // 3. Affichage du contenu principal
                    document.getElementById('adminContent').style.display = 'block';

                    // 4. Mise √† jour de la barre utilisateur (Nom, R√¥le, Avatar)
                    const nameDisplay = document.getElementById('userName');
                    const avatarDisplay = document.getElementById('userAvatar');
                    const roleDisplay = document.getElementById('userRole');

                    nameDisplay.innerText = profile.display_name || session.user.email;

                    // D√©finition du r√¥le (par d√©faut 'editeur' si vide)
                    const userRole = profile.role || "editeur";
                    if (roleDisplay) roleDisplay.innerText = userRole.toUpperCase();

                    // Gestion de l'avatar
                    if (profile.avatar_url) {
                        avatarDisplay.src = profile.avatar_url;
                    } else {
                        avatarDisplay.src = `https://ui-avatars.com/api/?name=${profile.display_name || 'Admin'}&background=4e7994&color=fff`;
                    }
                    avatarDisplay.style.display = 'block';

                    // --- üî¥ LOGIQUE D'AFFICHAGE DU BOUTON COMPTES üî¥ ---
                    // Si le r√¥le est 'admin', on affiche le bouton cach√©
                    if (userRole === 'admin' || userRole === 'administrator') {
                        const btnAccounts = document.getElementById('btnManageAccounts');
                        if (btnAccounts) {
                            btnAccounts.style.display = 'inline-block'; // Ou 'flex' selon votre CSS
                        }
                    }
                    // ----------------------------------------------------

                    // 5. Chargement des donn√©es de la page
                    // IMPORTANT : Si tu es sur la page "Projets", garde loadProjects()
                    // Si tu es sur la page "News", mets loadNews()
                    loadProjects();

                } catch (err) {
                    console.error("Erreur profil:", err);
                    // En cas d'erreur (ex: pas de profil cr√©√©), on affiche quand m√™me l'email
                    document.getElementById('userName').innerText = session.user.email;
                    document.getElementById('adminContent').style.display = 'block';

                    loadProjects();
                }
            }
            async function logout() {
                const { error } = await supabaseClient.auth.signOut();
                if (error) alert("Erreur lors de la d√©connexion");
            }

            supabaseClient.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_OUT') window.location.href = 'index.html';
            });

            checkUser();
            // ============================================================
            // VARIABLES GLOBALES
            // ============================================================
            let allProjects = [];
            let currentEditId = null;
            let currentEditImageUrl = "";

            // ============================================================
            // GESTION IMAGE PREVIEW (Drag & Drop style)
            // ============================================================
            const imageInput = document.getElementById('imageFile');
            const preview = document.getElementById('currentImagePreview');
            const placeholder = document.getElementById('uploadPlaceholder');
            const uploadArea = document.getElementById('uploadArea');

            imageInput.addEventListener('change', function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                        uploadArea.classList.add('has-image');
                    }
                    reader.readAsDataURL(file);
                }
            });

            // ============================================================
            // LOGIQUE TAGS TECH
            // ============================================================
            const availableTechs = [
                "HTML5", "CSS3", "JavaScript", "TypeScript", "Python", "PHP", "Java", "C#", "Go", "Swift",
                "React", "Vue.js", "Angular", "Next.js", "Node.js", "Django", "Laravel", "Spring Boot",
                "WordPress", "Shopify", "MySQL", "PostgreSQL", "MongoDB", "Firebase", "Supabase",
                "Docker", "Kubernetes", "AWS", "Google Cloud", "Figma", "Adobe XD", "Flutter", "React Native"
            ];
            let selectedTechs = [];
            const techInput = document.getElementById('techInput');
            const suggestionsBox = document.getElementById('suggestionsBox');
            const techWrapper = document.getElementById('techWrapper');

            techInput.addEventListener('input', function () {
                const val = this.value.toLowerCase();
                suggestionsBox.innerHTML = '';
                if (!val) { suggestionsBox.style.display = 'none'; return; }
                const matches = availableTechs.filter(t => t.toLowerCase().includes(val) && !selectedTechs.includes(t));
                if (matches.length > 0) {
                    matches.forEach(tech => {
                        const div = document.createElement('div');
                        div.className = 'suggestion-item';
                        div.textContent = tech;
                        div.onclick = () => addTech(tech);
                        suggestionsBox.appendChild(div);
                    });
                    suggestionsBox.style.display = 'block';
                } else { suggestionsBox.style.display = 'none'; }
            });

            function addTech(techName) {
                if (selectedTechs.includes(techName)) return;
                selectedTechs.push(techName);
                renderTags();
                techInput.value = '';
                suggestionsBox.style.display = 'none';
                techInput.focus();
            }

            function removeTech(techName) {
                selectedTechs = selectedTechs.filter(t => t !== techName);
                renderTags();
            }

            function renderTags() {
                const existingTags = techWrapper.querySelectorAll('.tech-tag');
                existingTags.forEach(t => t.remove());
                selectedTechs.forEach(tech => {
                    const tag = document.createElement('div');
                    tag.className = 'tech-tag';
                    tag.innerHTML = `${tech} <span onclick="removeTech('${tech}')">&times;</span>`;
                    techWrapper.insertBefore(tag, techInput);
                });
            }

            document.addEventListener('click', function (e) {
                if (!techWrapper.contains(e.target)) suggestionsBox.style.display = 'none';
            });

            // ============================================================
            // LOGIQUE FORMULAIRE
            // ============================================================
            function toggleFields() {
                const type = document.getElementById('projType').value;
                if (type === 'modal') {
                    document.getElementById('modalFields').classList.remove('hidden');
                    document.getElementById('linkFields').classList.add('hidden');
                } else {
                    document.getElementById('modalFields').classList.add('hidden');
                    document.getElementById('linkFields').classList.remove('hidden');
                }
            }

            document.getElementById('btnSave').addEventListener('click', async () => {
                const btn = document.getElementById('btnSave');
                const status = document.getElementById('statusMessage');

                // Get values
                const titleFR = document.getElementById('titleDefault').value;
                const descFR = document.getElementById('descDefault').value;
                const fullDescFR = document.getElementById('fullDesc').value;

                const titleEN = document.getElementById('titleEn').value;
                const descEN = document.getElementById('descEn').value;
                const fullDescEN = document.getElementById('fullDescEn').value;

                if (!titleFR) return alert("Le titre en fran√ßais est obligatoire !");

                btn.disabled = true;
                btn.innerHTML = currentEditId ? "üíæ Modification..." : "‚è≥ Publication...";
                status.style.display = 'none';

                try {
                    // 1. Image Upload Logic
                    let imageUrl = currentEditImageUrl || "https://placehold.co/600x400/e0e7ff/4e7994?text=Projet";
                    const fileInput = document.getElementById('imageFile');

                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const fileExt = file.name.split('.').pop();
                        const cleanName = `proj_${Date.now()}.${fileExt}`;

                        const { error: upError } = await supabaseClient.storage.from('portfolio-images').upload(cleanName, file);
                        if (upError) throw upError;

                        const { data: publicUrlData } = supabaseClient.storage.from('portfolio-images').getPublicUrl(cleanName);
                        imageUrl = publicUrlData.publicUrl;
                    }

                    // 2. Data Preparation
                    const catValue = document.getElementById('category').value;
                    const type = document.getElementById('projType').value;

                    // Gestion Tags manuels si pas dans la liste
                    if (selectedTechs.length === 0 && techInput.value.trim() !== "") {
                        selectedTechs.push(techInput.value.trim());
                    }
                    const techString = selectedTechs.join(', ');

                    // Traductions automatiques Cat√©gories
                    const labelsFR = {
                        'web': 'D√©veloppement Web', 'logiciel': 'Logiciels & Desktop', 'mobile': 'Applications Mobiles',
                        'infra': 'Infrastructure & Cloud', 'devops': 'DevOps & CI/CD', 'data': 'Data & IA',
                        'uiux': 'Design UI/UX', 'cyber': 'Cybers√©curit√©'
                    };
                    const labelsEN = {
                        'web': 'Web Development', 'logiciel': 'Software & Desktop', 'mobile': 'Mobile Apps',
                        'infra': 'Infrastructure & Cloud', 'devops': 'DevOps & CI/CD', 'data': 'Data & AI',
                        'uiux': 'UI/UX Design', 'cyber': 'Cybersecurity'
                    };

                    const modalDetailsFR = {
                        title: titleFR,
                        client: document.getElementById('clientName').value,
                        full_desc: fullDescFR,
                        tech: techString
                    };
                    const modalDetailsEN = {
                        title: titleEN || titleFR,
                        client: document.getElementById('clientName').value,
                        full_desc: fullDescEN || fullDescFR,
                        tech: techString
                    };

                    const projectData = {
                        type: type,
                        category: catValue,
                        image: imageUrl,
                        cat_key: `cat_${catValue}`,
                        cat_label: labelsFR[catValue],
                        cat_label_en: labelsEN[catValue],
                        title_default: titleFR,
                        desc_default: descFR,
                        modal_details: type === 'modal' ? modalDetailsFR : null,
                        title_en: titleEN || titleFR,
                        desc_en: descEN || descFR,
                        modal_details_en: type === 'modal' ? modalDetailsEN : null,
                        link_url: type === 'link' ? document.getElementById('linkUrl').value : null
                    };

                    // 3. Insert or Update
                    if (currentEditId) {
                        const { error } = await supabaseClient.from('projects').update(projectData).eq('id', currentEditId);
                        if (error) throw error;
                        status.innerHTML = "‚úÖ Projet modifi√© avec succ√®s !";
                    } else {
                        const { error } = await supabaseClient.from('projects').insert([projectData]);
                        if (error) throw error;
                        status.innerHTML = "‚ú® Projet ajout√© avec succ√®s !";
                    }

                    status.style.background = "#d1fae5";
                    status.style.color = "#065f46";
                    status.style.display = "block";

                    setTimeout(() => status.style.display = 'none', 3000);
                    resetForm();
                    loadProjects();

                } catch (error) {
                    console.error(error);
                    status.textContent = "‚ùå Erreur : " + error.message;
                    status.style.background = "#fee2e2";
                    status.style.color = "#991b1b";
                    status.style.display = "block";
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = currentEditId ? "üöÄ Mettre √† jour" : "üöÄ Publier le Projet";
                }
            });

            // ============================================================
            // EDIT & RESET
            // ============================================================
            window.editProject = (id) => {
                const proj = allProjects.find(p => p.id === id);
                if (!proj) return;

                currentEditId = id;
                currentEditImageUrl = proj.image;

                // UI Changes
                document.getElementById('formTitle').innerText = "Modifier le Projet";
                const btn = document.getElementById('btnSave');
                btn.innerHTML = "üíæ Mettre √† jour";
                btn.style.background = "#f59e0b"; // Warning color
                document.getElementById('btnCancel').style.display = 'flex';

                // Fill Simple Fields
                document.getElementById('projType').value = proj.type;
                document.getElementById('category').value = proj.category;

                document.getElementById('titleDefault').value = proj.title_default;
                document.getElementById('titleEn').value = proj.title_en || "";
                document.getElementById('descDefault').value = proj.desc_default;
                document.getElementById('descEn').value = proj.desc_en || "";

                // Fill Image Preview
                if (proj.image) {
                    preview.src = proj.image;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                    uploadArea.classList.add('has-image');
                }

                // Fill Modal Fields
                if (proj.type === 'modal' && proj.modal_details) {
                    document.getElementById('clientName').value = proj.modal_details.client || "";
                    document.getElementById('fullDesc').value = proj.modal_details.full_desc || "";
                    document.getElementById('fullDescEn').value = (proj.modal_details_en && proj.modal_details_en.full_desc) || "";

                    // Restore Tags
                    selectedTechs = [];
                    if (proj.modal_details.tech) {
                        selectedTechs = proj.modal_details.tech.split(',').map(s => s.trim()).filter(s => s);
                    }
                    renderTags();
                }

                // Fill Link Fields
                if (proj.type === 'link') {
                    document.getElementById('linkUrl').value = proj.link_url || "";
                }

                toggleFields();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function resetForm() {
                currentEditId = null;
                currentEditImageUrl = "";
                document.getElementById('formTitle').innerText = "Nouveau Projet";
                const btn = document.getElementById('btnSave');
                btn.innerHTML = "üöÄ Publier le Projet";
                btn.style.background = "var(--primary)";
                document.getElementById('btnCancel').style.display = 'none';

                // Reset Inputs
                document.querySelectorAll('input, textarea').forEach(i => i.value = "");
                document.getElementById('category').selectedIndex = 0;
                document.getElementById('projType').selectedIndex = 0;

                // Reset Tags
                selectedTechs = [];
                renderTags();

                // Reset Image
                preview.style.display = 'none';
                preview.src = "";
                placeholder.style.display = 'block';
                uploadArea.classList.remove('has-image');

                toggleFields();
            }

            document.getElementById('btnCancel').addEventListener('click', resetForm);

            // ============================================================
            // LISTING & DELETE
            // ============================================================
            async function loadProjects() {
                const listContainer = document.getElementById('projectsList');
                const { data, error } = await supabaseClient
                    .from('projects')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    listContainer.innerHTML = `<p style="color:red">Erreur : ${error.message}</p>`;
                    return;
                }

                allProjects = data; // Store globally
                listContainer.innerHTML = "";

                if (data.length === 0) {
                    listContainer.innerHTML = `<p style="text-align:center; color: var(--text-light);">Aucun projet.</p>`;
                    return;
                }

                data.forEach(proj => {
                    const card = document.createElement('div');
                    card.className = 'card-preview';
                    const imgDisplay = proj.image ? proj.image : 'https://placehold.co/600x400/e0e7ff/3730a3?text=No+Image';

                    card.innerHTML = `
                <img src="${imgDisplay}" alt="Proj">
                <div class="card-info">
                    <span class="card-cat">${proj.cat_label || proj.category}</span>
                    <div class="card-title">${proj.title_default}</div>
                    <div class="card-actions">
                        <button class="action-btn edit-btn" onclick="editProject(${proj.id})">‚úèÔ∏è Modifier</button>
                        <button class="action-btn delete-btn" onclick="deleteProject(${proj.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `;
                    listContainer.appendChild(card);
                });
            }

            window.deleteProject = async (id) => {
                if (confirm("Voulez-vous vraiment supprimer ce projet ?")) {
                    await supabaseClient.from('projects').delete().eq('id', id);
                    if (currentEditId === id) resetForm();
                    loadProjects();
                }
            }

            // Init
            loadProjects();
            toggleFields();

            // ==========================================
            // GESTION DES COMPTES (POP-UP)
            // ==========================================

            // 1. Ouvrir / Fermer la modale
            function openAccountModal() {
                resetAccView();
                document.getElementById('accountModal').style.display = 'flex';
            }

            function closeAccountModal() {
                document.getElementById('accountModal').style.display = 'none';
            }

            // 2. Navigation dans la modale
            function resetAccView() {
                document.getElementById('accMenu').style.display = 'flex';
                document.getElementById('accAddForm').style.display = 'none';
                document.getElementById('accListPanel').style.display = 'none';
                document.getElementById('newUsername').value = ''; // <--- RAJOUTER ICI
                document.getElementById('newEmail').value = '';
                document.getElementById('newPass').value = '';
            }

            function showAddUser() {
                document.getElementById('accMenu').style.display = 'none';
                document.getElementById('accAddForm').style.display = 'block';
            }

            async function showDeleteUser() {
                document.getElementById('accMenu').style.display = 'none';
                document.getElementById('accListPanel').style.display = 'block';
                loadUsersList();
            }

            // 3. CR√âER UN UTILISATEUR
            async function createUser() {
                const username = document.getElementById('newUsername').value;
                const email = document.getElementById('newEmail').value;
                const password = document.getElementById('newPass').value;
                const role = document.getElementById('newRole').value;

                if (!email || !password || !username) return alert("Email, Nom et mot de passe requis.");

                // Cr√©ation Auth Supabase
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        // C'est ici qu'on envoie les m√©tadonn√©es
                        data: {
                            display_name: username, // On envoie le vrai nom saisi
                            role: role
                        }
                    }
                });

                if (error) {
                    alert("Erreur : " + error.message);
                } else {
                    // Note: Si "Confirm Email" est activ√© dans Supabase, l'utilisateur ne pourra pas se connecter tout de suite.
                    alert("‚úÖ Utilisateur cr√©√© ! S'il ne peut pas se connecter, v√©rifiez si un mail de confirmation a √©t√© envoy√©.");
                    resetAccView();
                }
            }

            // 4. LISTER ET SUPPRIMER (Profils)
            async function loadUsersList() {
                const container = document.getElementById('usersListContainer');
                container.innerHTML = "Chargement...";

                // On r√©cup√®re la liste depuis la table 'profiles'
                const { data: profiles, error } = await supabaseClient
                    .from('profiles')
                    .select('id, display_name, role, email'); // Assurez-vous d'avoir une colonne email dans profiles ou utilisez display_name

                if (error) {
                    container.innerHTML = "Erreur de chargement.";
                    return;
                }

                let html = '<ul style="list-style:none; padding:0; margin:0;">';
                profiles.forEach(p => {
                    html += `
                <li style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${p.display_name || 'Utilisateur'}</strong> <br>
                        <small style="color:#666">${p.role || 'Editeur'}</small>
                    </div>
                    <button onclick="deleteUserProfile('${p.id}')" style="background:#fee2e2; color:red; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
                        üóëÔ∏è
                    </button>
                </li>
            `;
                });
                html += '</ul>';
                container.innerHTML = html;
            }

            async function deleteUserProfile(id) {
                if (!confirm("Voulez-vous supprimer ce profil de l'affichage ? (L'acc√®s login devra √™tre coup√© sur Supabase)")) return;

                const { error } = await supabaseClient
                    .from('profiles')
                    .delete()
                    .eq('id', id);

                if (error) {
                    alert("Erreur : " + error.message);
                } else {
                    loadUsersList(); // Recharger la liste
                }
            }
        </script>

</body>

</html>