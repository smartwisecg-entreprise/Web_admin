<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Portfolio Smart Wise</title>
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="stylesheet" href="projects-style.css">
    <!-- Police : Poppins (Comme News) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>


</head>

<body>

    <!-- BARRE DE NAVIGATION UNIFI√âE -->
    <div class="logout-bar">
        <div class="nav-links">
            <!-- Bouton vers l'autre page admin -->
            <a href="admin-news.html" class="nav-link-btn">üì∞ G√©rer les Actualit√©s</a>
        </div>

        <div class="user-info">
            <div class="user-profile-box">
                <img id="userAvatar" src="" alt="" style="display:none;">
                <div class="user-details">
                    <span id="userName">Chargement...</span>
                    <span id="userRole" class="role-badge">√âditeur</span>
                </div>
            </div>
            <!-- 2. NOUVEAU BOUTON COMPTES (Plac√© au milieu) -->
            <!-- Notez la classe "accounts-btn" que nous allons cr√©er -->
            <!-- BOUTON COMPTES (Ajout de l'ID et display:none) -->
            <button id="btnManageAccounts" onclick="openAccountModal()" class="accounts-btn" style="display:none;">
                üë• Comptes
            </button>
            <button onclick="logout()" class="logout-btn">D√©connexion üö™</button>
        </div>
    </div>
    <div id="adminContent">

        <div class="main-wrapper">
            <!-- FORMULAIRE -->
            <div class="card">
                <!-- EN-T√äTE DU FORMULAIRE AVEC LOGO -->
                <div class="header-container">
                    <!-- Mettez ici le lien de votre logo -->
                    <img src="/images/SMARTWISE_LOGO_FINAL_24_Septembre_2025.svg" alt="Logo Smart Wise"
                        class="header-logo">

                    <h1 id="formTitle">Nouveau Projet</h1>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Type d'affichage</label>
                        <select id="projType" onchange="toggleFields()">
                            <option value="modal">‚ú® Ouverture en Pop-up (Modale)</option>
                            <option value="link">üîó Redirection vers une page (Lien)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Domaine d'expertise</label>
                        <select id="category">
                            <option value="web">üåê D√©veloppement Web</option>
                            <option value="logiciel">üíª Logiciels & Desktop</option>
                            <option value="mobile">üì± Applications Mobiles</option>
                            <option value="infra">‚òÅÔ∏è Infrastructure & Cloud</option>
                            <option value="devops">üöÄ DevOps & CI/CD</option>
                            <option value="data">üìä Data & IA</option>
                            <option value="uiux">üé® Design UI/UX</option>
                            <option value="cyber">üîí Cybers√©curit√©</option>
                        </select>
                    </div>
                </div>

                <span class="section-title">Visuel & Accroche</span>

                <!-- ZONE IMAGE MODERNE -->
                <div class="form-group">
                    <label>Image de couverture</label>
                    <div class="image-upload-wrapper">
                        <div class="upload-area" id="uploadArea">
                            <div id="uploadPlaceholder">
                                <div class="upload-icon">üì∑</div>
                                <div class="upload-text">
                                    Cliquez pour ajouter une image<br>
                                    <small style="opacity:0.6">JPG, PNG, WEBP</small>
                                </div>
                            </div>
                            <img id="currentImagePreview" alt="Aper√ßu">
                        </div>
                        <input type="file" id="imageFile" accept="image/*">
                    </div>
                </div>

                <!-- TITRES FR / EN -->
                <div class="row">
                    <div class="col">
                        <label>Titre (FR) *</label>
                        <input type="text" id="titleDefault" placeholder="Ex: Refonte Site BTP">
                    </div>
                    <div class="col">
                        <label class="label-en">Title (EN)</label>
                        <input type="text" id="titleEn" placeholder="Optional English Title">
                    </div>
                </div>

                <!-- DESCRIPTIONS COURTES FR / EN -->
                <div class="row">
                    <div class="col">
                        <label>Accroche Courte (FR)</label>
                        <input type="text" id="descDefault" placeholder="1 phrase d'accroche...">
                    </div>
                    <div class="col">
                        <label class="label-en">Short Description (EN)</label>
                        <input type="text" id="descEn" placeholder="Optional short desc...">
                    </div>
                </div>

                <!-- CHAMPS MODALE -->
                <div id="modalFields">
                    <span class="section-title">D√©tails Techniques (Pop-up)</span>

                    <div class="form-group">
                        <label>Client / Contexte</label>
                        <input type="text" id="clientName" placeholder="Ex: Startup Fintech Paris">
                    </div>

                    <!-- TAGS INPUT -->
                    <div class="form-group" style="position: relative;">
                        <label>Stack Technique (Tags)</label>
                        <div class="tech-container" id="techWrapper">
                            <input type="text" id="techInput" class="tech-input" placeholder="Ajouter (ex: React)..."
                                autocomplete="off">
                        </div>
                        <div id="suggestionsBox" class="suggestions-box"></div>
                    </div>
                    <!-- DESCRIPTIONS COMPL√àTES -->
                    <div class="row">
                        <div class="col">
                            <label>Description Compl√®te (FR)</label>
                            <textarea id="fullDesc" placeholder="D√©tails du projet..."></textarea>
                        </div>
                        <div class="col">
                            <label class="label-en">Full Description (EN)</label>
                            <textarea id="fullDescEn" placeholder="Project details..."></textarea>
                        </div>
                    </div>

                    <!-- CHAMPS LIEN -->
                    <div id="linkFields" class="hidden">
                        <span class="section-title">Destination (Lien Direct)</span>
                        <div class="form-group">
                            <label>URL de destination</label>
                            <input type="text" id="linkUrl" placeholder="https://mon-site.com/projet">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button id="btnCancel" class="btn">Annuler</button>
                        <button id="btnSave" class="btn">üöÄ Publier le Projet</button>
                    </div>

                    <div id="statusMessage"></div>
                </div>

                <!-- LISTE -->
                <div class="card">
                    <h2>Projets en Ligne</h2>
                    <div id="projectsList" class="project-list">
                        <p style="text-align:center; color: var(--text-light);">Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- Modal Avatar style "WhatsApp" -->
            <div id="avatarModal" class="modal-overlay" style="display:none;">
                <div class="modal-card">
                    <div class="modal-header">
                        <h3>Photo de profil</h3>
                        <span class="close-modal" onclick="closeAvatarModal()">&times;</span>
                    </div>

                    <div class="modal-body">
                        <div class="img-container">
                            <img id="modalAvatarPreview" src="" alt="Aper√ßu">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="modal-btn upload-btn" onclick="triggerFileInput()">
                            <span>üì∑</span> Modifier
                        </button>
                        <button class="modal-btn delete-btn-modal" onclick="deleteAvatar()">
                            <span>üóëÔ∏è</span> Supprimer
                        </button>
                    </div>
                </div>
                <!-- Input invisible pour choisir le fichier -->
                <input type="file" id="avatarInputHidden" accept="image/*" style="display:none;"
                    onchange="uploadAvatar(this)">
            </div>

            <!-- MODALE GESTION COMPTES -->
            <div id="accountModal" class="modal-overlay" style="display:none;">
                <div class="modal-card" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>Gestion des Acc√®s</h3>
                        <span class="close-modal" onclick="closeAccountModal()">&times;</span>
                    </div>

                    <div class="modal-body" style="padding: 20px; background: #fff; min-height: auto;">

                        <!-- MENU PRINCIPAL (2 BOUTONS) -->
                        <div id="accMenu" style="display:flex; gap:15px; justify-content:center; padding: 20px 0;">
                            <button onclick="showAddUser()" class="btn" style="background:var(--primary);">
                                ‚ûï Ajouter un compte
                            </button>
                            <button onclick="showDeleteUser()" class="btn"
                                style="background: #fef2f2; color: var(--danger); border: 1px solid var(--danger);">
                                üóëÔ∏è Supprimer / Lister
                            </button>
                        </div>

                        <!-- FORMULAIRE AJOUT (Cach√© par d√©faut) -->
                        <div id="accAddForm" class="hidden">
                            <h4 style="margin-top:0;">Cr√©er un nouvel utilisateur</h4>
                            <div class="form-group">
                                <label>Nom d'utilisateur</label>
                                <input type="text" id="newUsername" placeholder="Ex: JeanDupont">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="text" id="newEmail" placeholder="email@smartwise.com">
                            </div>
                            <div class="form-group">
                                <label>Mot de passe provisoire</label>
                                <input type="text" id="newPass" placeholder="Min. 6 caract√®res">
                            </div>
                            <div class="form-group">
                                <label>R√¥le</label>
                                <select id="newRole">
                                    <option value="editeur">√âditeur</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            <div class="btn-group">
                                <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                                <button onclick="createUser()" class="btn"
                                    style="background:var(--primary);">Cr√©er</button>
                            </div>
                        </div>

                        <!-- LISTE SUPPRESSION (Cach√© par d√©faut) -->
                        <div id="accListPanel" class="hidden">
                            <h4 style="margin-top:0;">Utilisateurs actifs</h4>
                            <div id="usersListContainer"
                                style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px;">
                                <!-- La liste sera inject√©e ici par JS -->
                            </div>
                            <div class="btn-group">
                                <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                            </div>
                            <p style="font-size:0.75rem; color:orange; margin-top:10px;">
                                ‚ö†Ô∏è Note : La suppression ici retire le profil. Pour bloquer d√©finitivement l'acc√®s,
                                supprimez aussi l'utilisateur dans le tableau de bord Supabase.
                            </p>
                        </div>

                    </div>
                </div>
            </div>



        </div>


        <script src="projects.js">  </script>

</body>

</html>