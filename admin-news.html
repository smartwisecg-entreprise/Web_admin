<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Actualit√©s Smart Wise</title>
    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="news-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <style>
       
    </style>
</head>

<body>

    <!-- 1. Barre de navigation et d√©connexion -->
    <div class="logout-bar">
        <div class="nav-links">
            <!-- Bouton pour aller vers l'autre page admin -->
            <a href="admin-projects.html" class="nav-link-btn">üìÅ G√©rer les Projets</a>
        </div>
        <div class="user-info">
            <div class="user-profile-box">
                <img id="userAvatar" src="" alt="" style="display:none;">
                <div class="user-details">
                    <span id="userName">Chargement...</span>
                    <span id="userRole" class="role-badge">√âditeur</span>
                </div>
            </div>
            <button id="btnManageAccounts" onclick="openAccountModal()" class="accounts-btn" style="display:none;">
                üë• Comptes
            </button>
            <button onclick="logout()" class="logout-btn">D√©connexion üö™</button>
        </div>
    </div>
    <div id="adminContent">

        <div class="main-wrapper">
            <!-- FORMULAIRE -->
            <div class="card">
                <!-- EN-T√äTE DU FORMULAIRE -->
                <div class="header-container">
                    <!-- Remplacez l'URL ci-dessous par le lien de votre logo -->
                    <img src="/images/SMARTWISE_LOGO_FINAL_24_Septembre_2025.svg" alt="Logo Smart Wise"
                        class="header-logo">

                    <h1 id="formTitle">Publier une Actualit√©</h1>
                </div>
                <!-- CONFIGURATION -->
                <div class="form-grid">
                    <div>
                        <label>Date de publication</label>
                        <input type="date" id="date">
                    </div>
                    <div>
                        <label>Cat√©gorie</label>
                        <select id="category" class="form-input" required>
                            <option value="Produits & Services">Produits & Services</option>
                            <option value="Entreprise">Entreprise</option>
                            <option value="Technologie">Technologie</option>
                            <option value="Info Pratique">Info Pratique</option>
                            <option value="Impact">Impact</option>
                            <option value="√âv√©nement">√âv√©nement</option>
                            <!-- Toujours utile de garder celui-l√† √† part -->
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Image de couverture</label>
                    <div class="image-upload-wrapper">
                        <div class="upload-area" id="uploadArea">
                            <div id="uploadPlaceholder">
                                <div class="upload-icon">‚òÅÔ∏è</div>
                                <div class="upload-text">
                                    <span>Cliquez ici</span> pour ajouter une image
                                    <br><small style="opacity:0.7">JPG, PNG, WEBP (Max 2MB)</small>
                                </div>
                            </div>
                            <img id="currentImagePreview" alt="Aper√ßu">
                        </div>
                        <input type="file" id="imageFile" accept="image/*">
                    </div>
                </div>

                <!-- CONTENU FRAN√áAIS -->
                <div class="form-group">
                    <label>Titre (FR) *</label>
                    <input type="text" id="title_fr" placeholder="Ex: Lancement de la nouvelle version">
                </div>

                <div class="form-group">
                    <label>R√©sum√© court (FR)</label>
                    <textarea id="summary_fr" rows="2" placeholder="Une phrase d'accroche..."></textarea>
                </div>

                <div class="form-group">
                    <label>Contenu de l'article (FR) *</label>
                    <textarea id="content_fr" rows="6"
                        placeholder="<p>Le contenu complet de votre article...</p>"></textarea>
                </div>

                <!-- CONTENU ANGLAIS -->
                <!-- CONTENU ANGLAIS CORRIG√â -->
                <div class="en-section">

                    <!-- On utilise form-group (pleine largeur) au lieu de form-grid -->
                    <div class="form-group">
                        <label class="label-en">Title (EN)</label>
                        <input type="text" id="title_en" placeholder="Optional translation">
                    </div>

                    <div class="form-group">
                        <label class="label-en">Short Summary (EN)</label>
                        <textarea id="summary_en" rows="2" placeholder="Optional summary"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="label-en">Article Content (EN)</label>
                        <textarea id="content_en" rows="6" placeholder="Optional content"></textarea>
                    </div>
                </div>

                <div class="btn-group">
                    <button id="btnCancel" class="btn">
                        <span>Annuler</span>
                    </button>
                    <button id="btnSave" class="btn">
                        <span>üöÄ Publier l'article</span>
                    </button>
                </div>

                <div id="status"></div>
            </div>

            <!-- LISTE -->
            <div class="card">
                <h2>Articles en ligne</h2>
                <div id="newsList" class="news-list-container">
                    <p style="color:#94a3b8; text-align:center;">Chargement des articles...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Avatar style "WhatsApp" -->
    <div id="avatarModal" class="modal-overlay" style="display:none;">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Photo de profil</h3>
                <span class="close-modal" onclick="closeAvatarModal()">&times;</span>
            </div>

            <div class="modal-body">
                <div class="img-container">
                    <img id="modalAvatarPreview" src="" alt="Aper√ßu">
                </div>
            </div>

            <div class="modal-footer">
                <button class="modal-btn upload-btn" onclick="triggerFileInput()">
                    <span>üì∑</span> Modifier
                </button>
                <button class="modal-btn delete-btn-modal" onclick="deleteAvatar()">
                    <span>üóëÔ∏è</span> Supprimer
                </button>
            </div>
        </div>
        <!-- Input invisible pour choisir le fichier -->
        <input type="file" id="avatarInputHidden" accept="image/*" style="display:none;" onchange="uploadAvatar(this)">
    </div>

    <!-- MODALE GESTION COMPTES -->
    <div id="accountModal" class="modal-overlay" style="display:none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Gestion des Acc√®s</h3>
                <span class="close-modal" onclick="closeAccountModal()">&times;</span>
            </div>

            <div class="modal-body" style="padding: 20px; background: #fff; min-height: auto;">

                <!-- MENU PRINCIPAL (2 BOUTONS) -->
                <div id="accMenu" style="display:flex; gap:15px; justify-content:center; padding: 20px 0;">
                    <button onclick="showAddUser()" class="btn" style="background:var(--primary);">
                        ‚ûï Ajouter un compte
                    </button>
                    <button onclick="showDeleteUser()" class="btn"
                        style="background: #fef2f2; color: var(--danger); border: 1px solid var(--danger);">
                        üóëÔ∏è Supprimer / Lister
                    </button>
                </div>

                <!-- FORMULAIRE AJOUT (Cach√© par d√©faut) -->
                <div id="accAddForm" class="hidden">
                    <h4 style="margin-top:0;">Cr√©er un nouvel utilisateur</h4>
                    <div class="form-group">
                        <label>Nom d'utilisateur</label>
                        <input type="text" id="newUsername" placeholder="Ex: JeanDupont">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" id="newEmail" placeholder="email@smartwise.com">
                    </div>
                    <div class="form-group">
                        <label>Mot de passe provisoire</label>
                        <input type="text" id="newPass" placeholder="Min. 6 caract√®res">
                    </div>
                    <div class="form-group">
                        <label>R√¥le</label>
                        <select id="newRole">
                            <option value="editeur">√âditeur</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="btn-group">
                        <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                        <button onclick="createUser()" class="btn" style="background:var(--primary);">Cr√©er</button>
                    </div>
                </div>

                <!-- LISTE SUPPRESSION (Cach√© par d√©faut) -->
                <div id="accListPanel" class="hidden">
                    <h4 style="margin-top:0;">Utilisateurs actifs</h4>
                    <div id="usersListContainer"
                        style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px;">
                        <!-- La liste sera inject√©e ici par JS -->
                    </div>
                    <div class="btn-group">
                        <button onclick="resetAccView()" class="btn" style="background:#94a3b8;">Retour</button>
                    </div>
                    <p style="font-size:0.75rem; color:orange; margin-top:10px;">
                        ‚ö†Ô∏è Note : La suppression ici retire le profil. Pour bloquer d√©finitivement l'acc√®s,
                        supprimez aussi l'utilisateur dans le tableau de bord Supabase.
                    </p>
                </div>

            </div>
        </div>
    </div>


    <script src="news.js"></script>
</body>

</html>